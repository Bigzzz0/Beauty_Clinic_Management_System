# ข้อกำหนดความต้องการของระบบ (System Requirements Specification - SRS)

**โครงการ:** ระบบบริหารจัดการคลินิกความงามและคลังยา (Beauty Clinic Management System)  
**เวอร์ชัน:** 3.0 (Updated Course & Usage Logic)  
**วันที่อัปเดต:** 05 ธันวาคม 2025

---

## 1. ภาพรวมโครงการ (Project Overview)

### 1.1 ปัญหาปัจจุบัน (Current Pain Points)
*   **ระบบคอร์ส (Course Management):** การติดตามสิทธิ์คงเหลือของลูกค้าที่ซื้อคอร์ส (เช่น ซื้อ 10 ครั้ง ใช้ไป 3) ทำได้ยากและตรวจสอบลำบาก
*   **การตัดสต๊อก (Inventory):** การตัดสต๊อกหน้าเคาน์เตอร์ทันทีไม่สะท้อนความจริง เพราะบางครั้งหมอเบิกยาไปใช้แล้วค่อยมาลงบันทึก หรือปริมาณที่ใช้จริงไม่ตรงกับสูตร
*   **ค่าตอบแทน (Commission):** การคิดค่ามือจากยอดขายไม่ยุติธรรม เพราะใน 1 คอร์ส ลูกค้าอาจเข้ามาทำหลายครั้งกับหมอคนละคน ค่ามือควรเกิดจากการ "ทำงานจริง" ในแต่ละรอบ
*   **รายงานคลัง (Stock Report):** ฝ่ายคลังขาดเครื่องมือสรุปยอดประจำวัน/เดือน ว่าใช้อะไรไปเท่าไหร่และเหลือจริงเท่าไหร่

### 1.2 วัตถุประสงค์ (Objectives)
พัฒนาระบบที่รองรับ **"วงจรลูกค้า (Customer Journey)"** แบบครบวงจร:
1.  ขายคอร์ส
2.  ตัดเงิน
3.  ลูกค้ามาใช้บริการ (ทยอยใช้)
4.  บันทึกการรักษา
5.  ตัดสต๊อกตามจริง
6.  คำนวณค่ามือตามงานที่ทำ

---

## 2. ขอบเขตผู้ใช้งาน (User Roles)

*   **Admin/Owner:** ดูภาพรวม Dashboard, กำหนดราคาคอร์ส/ยา
*   **Doctor (แพทย์):** ดูประวัติ, บันทึกการรักษา, สั่งยา/หัตถการ
*   **Stock Staff (พนักงานคลัง):** รับสินค้า, ตัดสต๊อกจากการเบิกใช้จริง (Post-Treatment Deduction), ดูรายงานคงเหลือ
*   **Cashier/Sale (การเงิน):** ขายคอร์ส/ยา, รับชำระเงิน, ออกใบเสร็จ

---

## 3. รายละเอียดฟังก์ชันและตรรกะ (Functional Requirements & Logic)

### 3.1 ระบบจัดการคลังสินค้า (Inventory Management)
*เปลี่ยนจากตัดออโต้หน้า POS เป็นการตัดโดยฝ่ายคลังตามใบเบิก*

**A. การตัดสต๊อก (Usage Deduction)**
*   **Workflow:** หลังจากแพทย์ทำหัตถการเสร็จ -> ส่งข้อมูล/ใบเบิกให้ฝ่ายคลัง -> ฝ่ายคลังคีย์ตัดสต๊อกในหน้า "บันทึกการใช้ยา (Usage Record)"
*   **Logic:**
    *   เลือกคนไข้ และ เลือกรายการหัตถการที่ทำ (Service Usage)
    *   ระบุสินค้าที่ใช้จริง (Item & Qty) เช่น "Botox Aestox 50u", "เข็ม 2 อัน"
    *   ระบบคำนวณตัดจาก `Opened_Qty` ก่อน -> ถ้าหมดค่อยตัด `Full_Qty` (Auto-break pack)

**B. รายงานคลังสินค้า (Inventory Reports) (New)**
*   **Daily Usage Report:** รายงานสรุปประจำวันว่าวันนี้ตัดยาตัวไหนไปบ้าง จำนวนเท่าไหร่ (ใช้เช็คของสิ้นวัน)
*   **Monthly Balance Report:** สรุปยอดยกมา + รับเข้า - จ่ายออก = คงเหลือปลายงวด (Stock Card)

**C. การรับเข้าและโอนย้าย (Inbound & Transfer)**
*   บันทึกการรับของเข้า (Stock In) พร้อมระบุ Lot/Exp และแนบรูปภาพหลักฐาน
*   รองรับการโอนย้ายสินค้าระหว่างสาขา

### 3.2 ระบบจุดขายและการเงิน (POS & Finance)
*เน้นการขาย "สิทธิ์/คอร์ส" และการรับเงิน*

**A. การขาย (Sales Transaction)**
*   **สินค้าเน้นรูปแบบ:**
    *   **Course/Service:** ซื้อแล้วได้ "Credit/Quota" เก็บไว้ในบัญชีลูกค้า (ยังไม่ตัดสต๊อกยา)
*   **Pricing:** ราคาคิดตาม "คอร์ส" (เช่น คอร์สหน้าใส 10 ครั้ง 9,900 บาท)
*   **Payment:** รองรับการผ่อนชำระ (Partial Payment) และติดตามหนี้

**B. การใช้สิทธิ์ (Course Redemption)**
*   เมื่อลูกค้ามาใช้บริการ ให้มีเมนู "ใช้สิทธิ์คอร์ส (Redeem)"
*   ตัดจำนวนครั้งคงเหลือ (Balance) ของลูกค้านั้นๆ
*   เชื่อมโยงไปสร้างรายการ `Service_Usage` เพื่อให้ฝ่ายคลังไปตัดของต่อ

### 3.3 ระบบค่าตอบแทน (Commission & DF)
*เปลี่ยนจากคิดตอนขาย เป็นคิดตอน "ทำงาน"*

*   **Trigger Point:** ค่ามือ (DF/Hand Fee) จะถูกคำนวณเมื่อมีการ "บันทึกการรักษา/ใช้สิทธิ์ (Service Usage)"
*   **Multi-Staff:** ในการทำหัตถการ 1 ครั้ง สามารถระบุผู้ให้บริการได้หลายคน:
    *   หมอ A (ฉีด) -> ได้ค่า DF
    *   ผู้ช่วย B (เตรียมของ) -> ได้ค่า Hand Fee
    *   ผู้ช่วย C (นวดหน้า) -> ได้ค่า Hand Fee

### 3.4 ระบบเวชระเบียน (OPD & Safety)
*   **Alert:** แจ้งเตือนแพ้ยา/โรคประจำตัว (สีแดงกะพริบ)
*   **History:** แสดงประวัติการรักษาแบบ Timeline (วันที่, ทำอะไร, ใช้ยา Lot ไหน, ใครทำ)

---

## 4. โครงสร้างข้อมูล (Data Structure Overview)

### Master Data
*   `Product`: ข้อมูลยา/เวชภัณฑ์ (pack_size, is_liquid)
*   `Course`: ข้อมูลคอร์สหลัก (course_name, total_sessions, price)
*   `Staff`: พนักงานและตำแหน่ง

### Inventory
*   `Inventory_Realtime`: full_qty, opened_qty
*   `Stock_Movement`: Log การรับ/จ่าย/ปรับปรุง (action_type: USAGE, IN, OUT, CLAIM)

### Sales & Customer Assets
*   `Transaction_Header`: บิลขายเงินสด/คอร์ส
*   `Customer_Course`: เก็บโควตาคอร์สลูกค้า (remaining_sessions) **(New)**

### Service & Usage (หัวใจสำคัญใหม่)
*   `Service_Usage`: บันทึกการมาใช้บริการ 1 ครั้ง (Link กับ Customer_Course)
*   `Inventory_Usage`: บันทึกยาที่ใช้ในครั้งนั้น (Link กับ Service_Usage) -> ใช้ตัดสต๊อก
*   `Fee_Log`: บันทึกค่ามือหมอ/ผู้ช่วย (Link กับ Service_Usage)

---

## 5. เทคโนโลยีที่ใช้ (Tech Stack)

*   **Frontend:** React.js, Tailwind CSS
*   **Backend:** Node.js (Express)
*   **Database:** MySQL
*   **Storage:** File System / Cloud Storage (รูปภาพ)